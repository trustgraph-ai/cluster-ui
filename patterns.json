[
   {
      "module": {
         "services": {
            "init-pulsar": {
               "command": [
                  "sh",
                  "-c",
                  "pulsar-admin --admin-url http://pulsar:8080 tenants create tg && pulsar-admin --admin-url http://pulsar:8080 namespaces create tg/flow && pulsar-admin --admin-url http://pulsar:8080 namespaces create tg/request && pulsar-admin --admin-url http://pulsar:8080 namespaces create tg/response && pulsar-admin --admin-url http://pulsar:8080 namespaces set-retention --size -1 --time 3m tg/response"
               ],
               "depends_on": {
                  "pulsar": {
                     "condition": "service_started"
                  }
               },
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "0.5",
                        "memory": "128M"
                     },
                     "reservations": {
                        "cpus": "0.1",
                        "memory": "128M"
                     }
                  }
               },
               "image": "docker.io/apachepulsar/pulsar:3.3.1",
               "restart": "on-failure:100"
            },
            "pulsar": {
               "command": "bin/pulsar standalone",
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "1.0",
                        "memory": "900M"
                     },
                     "reservations": {
                        "cpus": "0.5",
                        "memory": "900M"
                     }
                  }
               },
               "environment": {
                  "PULSAR_MEM": "-Xms700M -Xmx700M"
               },
               "image": "docker.io/apachepulsar/pulsar:3.3.1",
               "ports": [
                  "6650:6650",
                  "8080:8080"
               ],
               "restart": "on-failure:100",
               "volumes": [
                  "pulsar-conf:/pulsar/conf",
                  "pulsar-data:/pulsar/data"
               ]
            },
            "pulsar-manager": {
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "0.5",
                        "memory": "1.4G"
                     },
                     "reservations": {
                        "cpus": "0.1",
                        "memory": "1.4G"
                     }
                  }
               },
               "environment": {
                  "SPRING_CONFIGURATION_FILE": "/pulsar-manager/pulsar-manager/application.properties"
               },
               "image": "docker.io/apachepulsar/pulsar-manager:v0.4.0",
               "ports": [
                  "9527:9527",
                  "7750:7750"
               ],
               "restart": "on-failure:100"
            }
         },
         "volumes": {
            "pulsar-conf": { },
            "pulsar-data": { }
         }
      },
      "pattern": {
         "args": [
            {
               "description": "An example argument",
               "name": "example",
               "required": false,
               "type": "string",
               "width": 20
            }
         ],
         "description": "Adds Pulsar support",
         "features": [
            "pulsar"
         ],
         "name": "pulsar",
         "requires": [ ]
      }
   },
   {
      "module": {
         "services": {
            "chunker": {
               "command": [
                  "${CHUNKER:-chunker-token}",
                  "-p",
                  "pulsar://pulsar:6650",
                  "--chunk-size",
                  "250",
                  "--chunk-overlap",
                  "15"
               ],
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "0.5",
                        "memory": "128M"
                     },
                     "reservations": {
                        "cpus": "0.1",
                        "memory": "128M"
                     }
                  }
               },
               "image": "docker.io/trustgraph/trustgraph-flow:0.8.0",
               "restart": "on-failure:100"
            },
            "embeddings": {
               "command": [
                  "embeddings-hf",
                  "-p",
                  "pulsar://pulsar:6650",
                  "-m",
                  "all-MiniLM-L6-v2"
               ],
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "1.0",
                        "memory": "256M"
                     },
                     "reservations": {
                        "cpus": "0.5",
                        "memory": "256M"
                     }
                  }
               },
               "image": "docker.io/trustgraph/trustgraph-flow:0.8.0",
               "restart": "on-failure:100"
            },
            "graph-rag": {
               "command": [
                  "graph-rag",
                  "-p",
                  "pulsar://pulsar:6650",
                  "--prompt-request-queue",
                  "non-persistent://tg/request/prompt-rag",
                  "--prompt-response-queue",
                  "non-persistent://tg/response/prompt-rag-response",
                  "--entity-limit",
                  "50",
                  "--triple-limit",
                  "30",
                  "--max-subgraph-size",
                  "3000"
               ],
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "0.5",
                        "memory": "128M"
                     },
                     "reservations": {
                        "cpus": "0.1",
                        "memory": "128M"
                     }
                  }
               },
               "image": "docker.io/trustgraph/trustgraph-flow:0.8.0",
               "restart": "on-failure:100"
            },
            "kg-extract-definitions": {
               "command": [
                  "kg-extract-definitions",
                  "-p",
                  "pulsar://pulsar:6650"
               ],
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "0.5",
                        "memory": "128M"
                     },
                     "reservations": {
                        "cpus": "0.1",
                        "memory": "128M"
                     }
                  }
               },
               "image": "docker.io/trustgraph/trustgraph-flow:0.8.0",
               "restart": "on-failure:100"
            },
            "kg-extract-relationships": {
               "command": [
                  "kg-extract-relationships",
                  "-p",
                  "pulsar://pulsar:6650"
               ],
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "0.5",
                        "memory": "128M"
                     },
                     "reservations": {
                        "cpus": "0.1",
                        "memory": "128M"
                     }
                  }
               },
               "image": "docker.io/trustgraph/trustgraph-flow:0.8.0",
               "restart": "on-failure:100"
            },
            "pdf-decoder": {
               "command": [
                  "pdf-decoder",
                  "-p",
                  "pulsar://pulsar:6650"
               ],
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "0.5",
                        "memory": "128M"
                     },
                     "reservations": {
                        "cpus": "0.1",
                        "memory": "128M"
                     }
                  }
               },
               "image": "docker.io/trustgraph/trustgraph-flow:0.8.0",
               "restart": "on-failure:100"
            },
            "vectorize": {
               "command": [
                  "embeddings-vectorize",
                  "-p",
                  "pulsar://pulsar:6650"
               ],
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "1.0",
                        "memory": "512M"
                     },
                     "reservations": {
                        "cpus": "0.5",
                        "memory": "512M"
                     }
                  }
               },
               "image": "docker.io/trustgraph/trustgraph-flow:0.8.0",
               "restart": "on-failure:100"
            }
         }
      },
      "pattern": {
         "args": [
            {
               "description": "An example argument",
               "name": "example",
               "required": false,
               "type": "string",
               "width": 20
            }
         ],
         "description": "Adds core Trustgraph flows",
         "features": [
            "trustgraph"
         ],
         "name": "trustgraph-base",
         "requires": [
            "pulsar"
         ]
      }
   },
   {
      "module": {
         "services": {
            "cassandra": {
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "1.0",
                        "memory": "800M"
                     },
                     "reservations": {
                        "cpus": "0.5",
                        "memory": "800M"
                     }
                  }
               },
               "environment": {
                  "JVM_OPTS": "-Xms256M -Xmx256M"
               },
               "image": "docker.io/cassandra:4.1.6",
               "ports": [
                  "9042:9042"
               ],
               "restart": "on-failure:100",
               "volumes": [
                  "cassandra:/var/lib/cassandra"
               ]
            },
            "query-triples": {
               "command": [
                  "triples-query-cassandra",
                  "-p",
                  "pulsar://pulsar:6650",
                  "-g",
                  "cassandra"
               ],
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "0.5",
                        "memory": "512M"
                     },
                     "reservations": {
                        "cpus": "0.1",
                        "memory": "512M"
                     }
                  }
               },
               "image": "docker.io/trustgraph/trustgraph-flow:0.8.0",
               "restart": "on-failure:100"
            },
            "store-triples": {
               "command": [
                  "triples-write-cassandra",
                  "-p",
                  "pulsar://pulsar:6650",
                  "-g",
                  "cassandra"
               ],
               "deploy": {
                  "resources": {
                     "limits": {
                        "cpus": "0.5",
                        "memory": "128M"
                     },
                     "reservations": {
                        "cpus": "0.1",
                        "memory": "128M"
                     }
                  }
               },
               "image": "docker.io/trustgraph/trustgraph-flow:0.8.0",
               "restart": "on-failure:100"
            }
         },
         "volumes": {
            "cassandra": { }
         }
      },
      "pattern": {
         "args": [
            {
               "description": "An example argument",
               "name": "example",
               "required": false,
               "type": "string",
               "width": 20
            }
         ],
         "description": "Adds Cassandra and Graph RAG components",
         "features": [
            "cassandra"
         ],
         "name": "graph-rag-cassandra",
         "requires": [
            "pulsar",
            "trustgraph"
         ]
      }
   }
]
